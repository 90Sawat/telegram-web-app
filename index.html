<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ –†–∞–±–æ—á–∞—è —Å—Ä–µ–¥–∞</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' https://telegram.org; script-src 'self' 'unsafe-inline' https://telegram.org; style-src 'self' 'unsafe-inline';">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 15px;
        }
        
        .status {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: left;
            font-size: 14px;
        }
        
        .success {
            background: rgba(0, 255, 0, 0.2);
            border-left: 5px solid #00ff00;
        }
        
        .error {
            background: rgba(255, 0, 0, 0.2);
            border-left: 5px solid #ff0000;
        }
        
        .warning {
            background: rgba(255, 165, 0, 0.2);
            border-left: 5px solid #ffa500;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: white;
            color: #764ba2;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
        }
        
        .btn:hover {
            background: #f0f0f0;
        }
        
        .debug-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 12px;
            text-align: left;
            overflow-wrap: break-word;
        }
        
        .telegram-logo {
            font-size: 40px;
            margin-bottom: 20px;
        }
        
        .instructions {
            text-align: left;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .instructions ol {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="telegram-logo">üì±</div>
        <h1>–†–∞–±–æ—á–∞—è —Å—Ä–µ–¥–∞ –æ–±—â–µ–Ω–∏—è</h1>
        <p>–ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –∞–Ω–æ–Ω–∏–º–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
        
        <div class="status" id="statusBox">
            <div id="statusText">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram...</div>
        </div>
        
        <div class="instructions">
            <strong>–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å:</strong>
            <ol>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram</li>
                <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üåê –û—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–≤–µ—Ä—Å–∏—é"</li>
                <li>–ù–µ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞–ø—Ä—è–º—É—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ!</li>
                <li>–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –Ω–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É –∫–æ–º–∞–Ω–¥—É /start</li>
            </ol>
        </div>
        
        <button class="btn" onclick="testConnection()">
            üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        </button>
        
        <button class="btn" onclick="showDebugInfo()">
            üêõ –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        </button>
        
        <a href="https://t.me/chat_Minddoc_bot" class="btn" target="_blank">
            üì≤ –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ @chat_Minddoc_bot
        </a>
        
        <div class="debug-info" id="debugInfo" style="display: none;">
            <strong>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong>
            <div id="debugContent"></div>
        </div>
    </div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Telegram Web App
        function checkTelegram() {
            console.log('=== –ü–†–û–í–ï–†–ö–ê TELEGRAM WEB APP ===');
            
            // –°–ø–æ—Å–æ–± 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—ä–µ–∫—Ç Telegram
            if (window.Telegram && window.Telegram.WebApp) {
                console.log('‚úÖ Telegram.WebApp –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
                return window.Telegram.WebApp;
            }
            
            // –°–ø–æ—Å–æ–± 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º window.TelegramWebApp (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç)
            if (window.TelegramWebApp) {
                console.log('‚úÖ TelegramWebApp –æ–±–Ω–∞—Ä—É–∂–µ–Ω (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç)');
                return window.TelegramWebApp;
            }
            
            // –°–ø–æ—Å–æ–± 3: –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ iframe
            if (window.parent && window.parent.Telegram && window.parent.Telegram.WebApp) {
                console.log('‚úÖ Telegram.WebApp –æ–±–Ω–∞—Ä—É–∂–µ–Ω –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –æ–∫–Ω–µ');
                return window.parent.Telegram.WebApp;
            }
            
            console.log('‚ùå Telegram Web App –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
            return null;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        function initTelegram() {
            const tg = checkTelegram();
            
            if (tg) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ
                window.tg = tg;
                
                // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
                try {
                    tg.expand();
                    console.log('‚úÖ Telegram Web App —Ä–∞—Å—à–∏—Ä–µ–Ω');
                } catch (e) {
                    console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å—à–∏—Ä–∏—Ç—å:', e.message);
                }
                
                // –ì–æ–≤–æ—Ä–∏–º Telegram —á—Ç–æ –≥–æ—Ç–æ–≤—ã
                try {
                    tg.ready();
                    console.log('‚úÖ Telegram Web App –≥–æ—Ç–æ–≤');
                } catch (e) {
                    console.log('‚ö†Ô∏è ready() –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', e.message);
                }
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                let userInfo = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    const user = tg.initDataUnsafe.user;
                    userInfo = `ID: ${user.id}`;
                    if (user.first_name) userInfo += `, –ò–º—è: ${user.first_name}`;
                    if (user.username) userInfo += `, @${user.username}`;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                document.getElementById('statusText').innerHTML = `
                    <strong>‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Telegram Web App!</strong><br><br>
                    üí¨ <strong>–°—Ç–∞—Ç—É—Å:</strong> –í Telegram<br>
                    üë§ <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> ${userInfo}<br>
                    üì± <strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> ${tg.platform || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>
                    üé® <strong>–¢–µ–º–∞:</strong> ${tg.colorScheme || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                `;
                document.getElementById('statusBox').className = 'status success';
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ Telegram
                try {
                    tg.setBackgroundColor('#667eea');
                    console.log('‚úÖ –¶–≤–µ—Ç —Ñ–æ–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                } catch (e) {
                    console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ü–≤–µ—Ç —Ñ–æ–Ω–∞');
                }
                
                // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
                try {
                    tg.MainButton.setText('–ó–ê–ö–†–´–¢–¨').show().onClick(function() {
                        tg.close();
                    });
                    console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞');
                } catch (e) {
                    console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è');
                }
                
                return true;
                
            } else {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (Telegram –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ hash)
                const urlParams = new URLSearchParams(window.location.search);
                const hashParams = window.location.hash.substring(1);
                
                console.log('URL search:', window.location.search);
                console.log('URL hash:', window.location.hash);
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Telegram –≤ URL
                if (window.location.hash.includes('tgWebAppData=') || 
                    window.location.search.includes('tgWebAppData=')) {
                    
                    document.getElementById('statusText').innerHTML = `
                        <strong>‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ Telegram, –Ω–æ WebApp –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω</strong><br><br>
                        –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:<br>
                        1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)<br>
                        2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Telegram<br>
                        3. –û—Ç–∫—Ä—ã—Ç—å –∑–∞–Ω–æ–≤–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
                    `;
                    document.getElementById('statusBox').className = 'status warning';
                    
                } else {
                    // –ù–µ—Ç Telegram –≤–æ–æ–±—â–µ
                    document.getElementById('statusText').innerHTML = `
                        <strong>‚ùå –ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Telegram</strong><br><br>
                        –í—ã –æ—Ç–∫—Ä—ã–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ.<br>
                        –î–ª—è —Ä–∞–±–æ—Ç—ã –æ—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.
                    `;
                    document.getElementById('statusBox').className = 'status error';
                }
                
                return false;
            }
        }
        
        // –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function testConnection() {
            const tg = checkTelegram();
            if (tg) {
                alert('‚úÖ Telegram Web App –ø–æ–¥–∫–ª—é—á–µ–Ω!\n\n–í–µ—Ä—Å–∏—è: ' + (tg.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ') + 
                      '\n–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ' + (tg.platform || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'));
            } else {
                alert('‚ùå Telegram Web App –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω.\n\n–û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.');
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        function showDebugInfo() {
            const debugContent = document.getElementById('debugContent');
            const debugBox = document.getElementById('debugInfo');
            
            let debugHtml = '';
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ
            debugHtml += `<strong>User Agent:</strong> ${navigator.userAgent}<br>`;
            debugHtml += `<strong>URL:</strong> ${window.location.href}<br>`;
            debugHtml += `<strong>Hash:</strong> ${window.location.hash || '(–ø—É—Å—Ç–æ)'}<br>`;
            debugHtml += `<strong>Search:</strong> ${window.location.search || '(–ø—É—Å—Ç–æ)'}<br><br>`;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram
            const tg = checkTelegram();
            debugHtml += `<strong>Telegram.WebApp:</strong> ${!!tg}<br>`;
            
            if (tg) {
                debugHtml += `<strong>–í–µ—Ä—Å–∏—è:</strong> ${tg.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>`;
                debugHtml += `<strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> ${tg.platform || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>`;
                debugHtml += `<strong>InitData:</strong> ${tg.initData ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'}<br>`;
                
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    const user = tg.initDataUnsafe.user;
                    debugHtml += `<strong>User ID:</strong> ${user.id}<br>`;
                    debugHtml += `<strong>–ò–º—è:</strong> ${user.first_name || ''}<br>`;
                    debugHtml += `<strong>–§–∞–º–∏–ª–∏—è:</strong> ${user.last_name || ''}<br>`;
                    debugHtml += `<strong>Username:</strong> ${user.username || ''}<br>`;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—Ä—É–≥–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
            debugHtml += `<br><strong>window.Telegram:</strong> ${!!window.Telegram}<br>`;
            debugHtml += `<strong>window.TelegramWebApp:</strong> ${!!window.TelegramWebApp}<br>`;
            debugHtml += `<strong>window.parent.Telegram:</strong> ${!!(window.parent && window.parent.Telegram)}<br>`;
            
            debugContent.innerHTML = debugHtml;
            debugBox.style.display = 'block';
            
            // –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Å–æ–ª—å
            console.log('=== DEBUG INFO ===');
            console.log('URL:', window.location.href);
            console.log('Telegram exists:', !!tg);
            if (tg) {
                console.log('Telegram object:', tg);
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
        function sendToBot(data) {
            const tg = window.tg;
            if (tg && tg.sendData) {
                try {
                    tg.sendData(JSON.stringify(data));
                    alert('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É');
                } catch (e) {
                    alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + e.message);
                }
            } else {
                alert('‚ùå –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞\n–û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞');
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        function closeApp() {
            const tg = window.tg;
            if (tg && tg.close) {
                tg.close();
            } else {
                alert('–ó–∞–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É –±—Ä–∞—É–∑–µ—Ä–∞');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== –ó–ê–ì–†–£–ó–ö–ê –°–¢–†–ê–ù–ò–¶–´ ===');
            console.log('–í—Ä–µ–º—è:', new Date().toLocaleTimeString());
            
            // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
            setTimeout(() => {
                initTelegram();
            }, 500);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
            setInterval(() => {
                const timeElement = document.getElementById('currentTime');
                if (timeElement) {
                    timeElement.textContent = new Date().toLocaleTimeString();
                }
            }, 1000);
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç Telegram
        if (window.addEventListener) {
            window.addEventListener('message', function(event) {
                console.log('Message received:', event);
                if (event.data && event.data.type === 'telegram') {
                    console.log('Telegram message:', event.data);
                }
            });
        }
    </script>
</body>
</html>